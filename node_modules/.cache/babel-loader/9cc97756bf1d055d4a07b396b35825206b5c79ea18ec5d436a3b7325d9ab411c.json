{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ConnectionTCPFull = exports.FullPacketCodec = void 0;\nconst buffer_1 = require(\"buffer/\");\nconst Connection_1 = require(\"./Connection\");\nconst Helpers_1 = require(\"../../Helpers\");\nconst errors_1 = require(\"../../errors\");\nclass FullPacketCodec extends Connection_1.PacketCodec {\n  constructor(connection) {\n    super(connection);\n    this._sendCounter = 0; // Telegram will ignore us otherwise\n  }\n\n  encodePacket(data) {\n    // https://core.telegram.org/mtproto#tcp-transport\n    // total length, sequence number, packet and checksum (CRC32)\n    const length = data.length + 12;\n    const e = buffer_1.Buffer.alloc(8);\n    e.writeInt32LE(length, 0);\n    e.writeInt32LE(this._sendCounter, 4);\n    data = buffer_1.Buffer.concat([e, data]);\n    const crc = buffer_1.Buffer.alloc(4);\n    crc.writeUInt32LE((0, Helpers_1.crc32)(data), 0);\n    this._sendCounter += 1;\n    return buffer_1.Buffer.concat([data, crc]);\n  }\n  /**\r\n   *\r\n   * @param reader {PromisedWebSockets}\r\n   * @returns {Promise<*>}\r\n   */\n  async readPacket(reader) {\n    const packetLenSeq = await reader.readExactly(8); // 4 and 4\n    if (packetLenSeq === undefined) {\n      // Return empty buffer in case of issue\n      return buffer_1.Buffer.alloc(0);\n    }\n    const packetLen = packetLenSeq.readInt32LE(0);\n    let body = await reader.readExactly(packetLen - 8);\n    const checksum = body.slice(-4).readUInt32LE(0);\n    body = body.slice(0, -4);\n    const validChecksum = (0, Helpers_1.crc32)(buffer_1.Buffer.concat([packetLenSeq, body]));\n    if (!(validChecksum === checksum)) {\n      throw new errors_1.InvalidChecksumError(checksum, validChecksum);\n    }\n    return body;\n  }\n}\nexports.FullPacketCodec = FullPacketCodec;\nclass ConnectionTCPFull extends Connection_1.Connection {\n  constructor() {\n    super(...arguments);\n    this.PacketCodecClass = FullPacketCodec;\n  }\n}\nexports.ConnectionTCPFull = ConnectionTCPFull;","map":{"version":3,"names":["Object","defineProperty","exports","value","ConnectionTCPFull","FullPacketCodec","buffer_1","require","Connection_1","Helpers_1","errors_1","PacketCodec","constructor","connection","_sendCounter","encodePacket","data","length","e","Buffer","alloc","writeInt32LE","concat","crc","writeUInt32LE","crc32","readPacket","reader","packetLenSeq","readExactly","undefined","packetLen","readInt32LE","body","checksum","slice","readUInt32LE","validChecksum","InvalidChecksumError","Connection","arguments","PacketCodecClass"],"sources":["C:/Users/Muhammed/Desktop/REACT_JS/dene-gramjs/node_modules/telegram/network/connection/TCPFull.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ConnectionTCPFull = exports.FullPacketCodec = void 0;\r\nconst buffer_1 = require(\"buffer/\");\r\nconst Connection_1 = require(\"./Connection\");\r\nconst Helpers_1 = require(\"../../Helpers\");\r\nconst errors_1 = require(\"../../errors\");\r\nclass FullPacketCodec extends Connection_1.PacketCodec {\r\n    constructor(connection) {\r\n        super(connection);\r\n        this._sendCounter = 0; // Telegram will ignore us otherwise\r\n    }\r\n    encodePacket(data) {\r\n        // https://core.telegram.org/mtproto#tcp-transport\r\n        // total length, sequence number, packet and checksum (CRC32)\r\n        const length = data.length + 12;\r\n        const e = buffer_1.Buffer.alloc(8);\r\n        e.writeInt32LE(length, 0);\r\n        e.writeInt32LE(this._sendCounter, 4);\r\n        data = buffer_1.Buffer.concat([e, data]);\r\n        const crc = buffer_1.Buffer.alloc(4);\r\n        crc.writeUInt32LE((0, Helpers_1.crc32)(data), 0);\r\n        this._sendCounter += 1;\r\n        return buffer_1.Buffer.concat([data, crc]);\r\n    }\r\n    /**\r\n     *\r\n     * @param reader {PromisedWebSockets}\r\n     * @returns {Promise<*>}\r\n     */\r\n    async readPacket(reader) {\r\n        const packetLenSeq = await reader.readExactly(8); // 4 and 4\r\n        if (packetLenSeq === undefined) {\r\n            // Return empty buffer in case of issue\r\n            return buffer_1.Buffer.alloc(0);\r\n        }\r\n        const packetLen = packetLenSeq.readInt32LE(0);\r\n        let body = await reader.readExactly(packetLen - 8);\r\n        const checksum = body.slice(-4).readUInt32LE(0);\r\n        body = body.slice(0, -4);\r\n        const validChecksum = (0, Helpers_1.crc32)(buffer_1.Buffer.concat([packetLenSeq, body]));\r\n        if (!(validChecksum === checksum)) {\r\n            throw new errors_1.InvalidChecksumError(checksum, validChecksum);\r\n        }\r\n        return body;\r\n    }\r\n}\r\nexports.FullPacketCodec = FullPacketCodec;\r\nclass ConnectionTCPFull extends Connection_1.Connection {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.PacketCodecClass = FullPacketCodec;\r\n    }\r\n}\r\nexports.ConnectionTCPFull = ConnectionTCPFull;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}