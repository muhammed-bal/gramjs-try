{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AuthKey = void 0;\nconst buffer_1 = require(\"buffer/\");\nconst Helpers_1 = require(\"../Helpers\");\nconst extensions_1 = require(\"../extensions\");\nconst Helpers_2 = require(\"../Helpers\");\nclass AuthKey {\n  constructor(value, hash) {\n    if (!hash || !value) {\n      return;\n    }\n    this._key = value;\n    this._hash = hash;\n    const reader = new extensions_1.BinaryReader(hash);\n    this.auxHash = reader.readLong(false);\n    reader.read(4);\n    this.keyId = reader.readLong(false);\n  }\n  async setKey(value) {\n    if (!value) {\n      this._key = this.auxHash = this.keyId = this._hash = undefined;\n      return;\n    }\n    if (value instanceof AuthKey) {\n      this._key = value._key;\n      this.auxHash = value.auxHash;\n      this.keyId = value.keyId;\n      this._hash = value._hash;\n      return;\n    }\n    this._key = value;\n    this._hash = await (0, Helpers_1.sha1)(this._key);\n    const reader = new extensions_1.BinaryReader(this._hash);\n    this.auxHash = reader.readLong(false);\n    reader.read(4);\n    this.keyId = reader.readLong(false);\n  }\n  async waitForKey() {\n    while (!this.keyId) {\n      await (0, Helpers_2.sleep)(20);\n    }\n  }\n  getKey() {\n    return this._key;\n  }\n  // TODO : This doesn't really fit here, it's only used in authentication\n  /**\r\n   * Calculates the new nonce hash based on the current class fields' values\r\n   * @param newNonce\r\n   * @param number\r\n   * @returns {bigInt.BigInteger}\r\n   */\n  async calcNewNonceHash(newNonce, number) {\n    if (this.auxHash) {\n      const nonce = (0, Helpers_1.toSignedLittleBuffer)(newNonce, 32);\n      const n = buffer_1.Buffer.alloc(1);\n      n.writeUInt8(number, 0);\n      const data = buffer_1.Buffer.concat([nonce, buffer_1.Buffer.concat([n, (0, Helpers_1.readBufferFromBigInt)(this.auxHash, 8, true)])]);\n      // Calculates the message key from the given data\n      const shaData = (await (0, Helpers_1.sha1)(data)).slice(4, 20);\n      return (0, Helpers_1.readBigIntFromBuffer)(shaData, true, true);\n    }\n    throw new Error(\"Auth key not set\");\n  }\n  equals(other) {\n    var _a;\n    return other instanceof this.constructor && this._key && buffer_1.Buffer.isBuffer(other.getKey()) && ((_a = other.getKey()) === null || _a === void 0 ? void 0 : _a.equals(this._key));\n  }\n}\nexports.AuthKey = AuthKey;","map":{"version":3,"names":["Object","defineProperty","exports","value","AuthKey","buffer_1","require","Helpers_1","extensions_1","Helpers_2","constructor","hash","_key","_hash","reader","BinaryReader","auxHash","readLong","read","keyId","setKey","undefined","sha1","waitForKey","sleep","getKey","calcNewNonceHash","newNonce","number","nonce","toSignedLittleBuffer","n","Buffer","alloc","writeUInt8","data","concat","readBufferFromBigInt","shaData","slice","readBigIntFromBuffer","Error","equals","other","_a","isBuffer"],"sources":["C:/Users/Muhammed/Desktop/REACT_JS/dene-gramjs/node_modules/telegram/crypto/AuthKey.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.AuthKey = void 0;\r\nconst buffer_1 = require(\"buffer/\");\r\nconst Helpers_1 = require(\"../Helpers\");\r\nconst extensions_1 = require(\"../extensions\");\r\nconst Helpers_2 = require(\"../Helpers\");\r\nclass AuthKey {\r\n    constructor(value, hash) {\r\n        if (!hash || !value) {\r\n            return;\r\n        }\r\n        this._key = value;\r\n        this._hash = hash;\r\n        const reader = new extensions_1.BinaryReader(hash);\r\n        this.auxHash = reader.readLong(false);\r\n        reader.read(4);\r\n        this.keyId = reader.readLong(false);\r\n    }\r\n    async setKey(value) {\r\n        if (!value) {\r\n            this._key = this.auxHash = this.keyId = this._hash = undefined;\r\n            return;\r\n        }\r\n        if (value instanceof AuthKey) {\r\n            this._key = value._key;\r\n            this.auxHash = value.auxHash;\r\n            this.keyId = value.keyId;\r\n            this._hash = value._hash;\r\n            return;\r\n        }\r\n        this._key = value;\r\n        this._hash = await (0, Helpers_1.sha1)(this._key);\r\n        const reader = new extensions_1.BinaryReader(this._hash);\r\n        this.auxHash = reader.readLong(false);\r\n        reader.read(4);\r\n        this.keyId = reader.readLong(false);\r\n    }\r\n    async waitForKey() {\r\n        while (!this.keyId) {\r\n            await (0, Helpers_2.sleep)(20);\r\n        }\r\n    }\r\n    getKey() {\r\n        return this._key;\r\n    }\r\n    // TODO : This doesn't really fit here, it's only used in authentication\r\n    /**\r\n     * Calculates the new nonce hash based on the current class fields' values\r\n     * @param newNonce\r\n     * @param number\r\n     * @returns {bigInt.BigInteger}\r\n     */\r\n    async calcNewNonceHash(newNonce, number) {\r\n        if (this.auxHash) {\r\n            const nonce = (0, Helpers_1.toSignedLittleBuffer)(newNonce, 32);\r\n            const n = buffer_1.Buffer.alloc(1);\r\n            n.writeUInt8(number, 0);\r\n            const data = buffer_1.Buffer.concat([\r\n                nonce,\r\n                buffer_1.Buffer.concat([n, (0, Helpers_1.readBufferFromBigInt)(this.auxHash, 8, true)]),\r\n            ]);\r\n            // Calculates the message key from the given data\r\n            const shaData = (await (0, Helpers_1.sha1)(data)).slice(4, 20);\r\n            return (0, Helpers_1.readBigIntFromBuffer)(shaData, true, true);\r\n        }\r\n        throw new Error(\"Auth key not set\");\r\n    }\r\n    equals(other) {\r\n        var _a;\r\n        return (other instanceof this.constructor &&\r\n            this._key &&\r\n            buffer_1.Buffer.isBuffer(other.getKey()) &&\r\n            ((_a = other.getKey()) === null || _a === void 0 ? void 0 : _a.equals(this._key)));\r\n    }\r\n}\r\nexports.AuthKey = AuthKey;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}